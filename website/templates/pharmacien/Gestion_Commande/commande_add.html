{% extends 'pharmacien/main.html' %}
{% load static %}
{% block content %}
{% if request.user.activite == "phar" %}
{% for message in messages %}
					<div  class="alert alert-success alert-dismissible fade show" role="alert">
                        <p> {{message}} </p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                       </button>
                    </div>      
{% endfor %}
<div class="row">
	<div class="col-lg-12" style="position:initial">
		<div class="card card-body" style="position:initial">
		     <div class="form-row">
				<div class="col-md-8" style="position:initial;margin-top:-5px;">
				   <a  class="btn btn-outline-danger " href="{% url 'commande'%}"> &larrhk; Retoure au list</a>
				</div>
				<div class="col-md-4" style="position:initial;margin-top:-5px;text-align:end;">
				    <a  class=" show-form btn btn-outline-success" > &#43; Ajouter Médicament au commande</a>
				</div>
		    </div>
		    <hr style="    border-color: transparent;margin-top:-2px">
           
						{% csrf_token %}
			<table class="table">
                <tr>
                    <th><h5>Médicaments: <strong>{{order.get_commande_articl}}</strong></h5></th>
					<th> 
					  <h5>
					    <select class=" custom-select" id="soso">
			              {% if order.fournisseur %}
						  <option value="{{order.fournisseur}}" selected>{{order.fournisseur}}</option>
						  {% else %}
						  <option value="" selected>Fournisseur</option>
						  {% endif %}
						  {% for i in fournisseur %}}
						  <option value="{{i.nom}}">{{i.nom}}</option>
						  {% endfor %}
						</select>
					  </h5>
					  
					</th>
                    <th>
                        <a style="float:right; margin:5px;" class="btn btn-danger" id="" href="{% url 'send_eamil' order.id%}"> → E-mail</a>					
                        <button  style="float:right; margin:5px;" class="btn btn-success" id="commande">Sauvgarder</button>
                    </th>
                </tr>
            </table>
			
        </div>

		<br>
           <div class="card card-body" style="position:initial">
				<div class="cart-row">
					<div style="flex:2"></div>
					<div style="flex:2"><strong>Medicament</strong></div>
					<div style="flex:1"><strong>Quantité</strong></div>
				</div>
		{% for item in items%}	
			<div class="cart-row">
					<div style="flex:2"><img class="row-image" src="{{item.medicament.image_url}}"></div>
					<div style="flex:2"><p>{{item.medicament.nom_c}}</p></div>
					<div style="flex:1">
					    <p class="quantity">{{item.qte_commande}}</p>
						<div class="quantity">
							<img data-item="{{item.medicament.id}}" class="chg-quantity update-commande"  data-action="add" src="{% static  'img/arrow-up.png' %}">
					
							<img data-item="{{item.medicament.id}}" class="chg-quantity update-commande" data-action="remove" src="{% static  'img/arrow-down.png' %}">
						</div>
					</div>
		   </div>
		   {% endfor %}
		</div>
	</div>
</div>

<div class="modal fade" id="modal-stock" >
    <div class="modal-dialog" style="max-width:600px">
        <div class="modal-content">
		  <div class="box-element">
				<div class="cart-row">
					<div style="flex:2"></div>
					<div style="flex:2;text-align:center;"><strong>Medicament</strong></div>
					<div style="flex:4;text-align:center;"><strong>Action</strong></div>
				</div>
		    {% for item in medicaments%}
			   {% if item.qte > 0 %}
                <div class="cart-row">
					<div style="flex:2"><img class="row-image" src="{{item.image_url}}"></div>
					<div style="flex:2;text-align:center;"><p>{{item.nom_c}}</p></div>
					<div style="flex:4;text-align:center;" >
					    <button data-item="{{item.id}}" data-action="add" class="btn btn-outline-secondary add-btn update-commande">Ajouter</button>	
					</div>
				</div>
				{% endif%}
		    {% endfor %}
		  </div>
        </div>
    </div>
</div>
    
         
{% endif %}
<script>

            var tota = '{{order.get_commande_articl|floatformat:0}}'
			
			
            
    
            var e = document.getElementById("soso");
            var option  = e.options[e.selectedIndex].value;
           
 


              function getCookie(name) 
            {
                  var cookieValue = null;
                  if (document.cookie && document.cookie !== '') {
                     var cookies = document.cookie.split(';');
                     for (var i = 0; i < cookies.length; i++) {
                           var cookie = cookies[i].trim();
                           // Does this cookie string begin with the name we want?
                           if (cookie.substring(0, name.length + 1) === (name + '=')) {
                              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                              break;
                           }
                     }
                  }
                  return cookieValue;
            }
			
			var csrftoken = getCookie('csrftoken')
            document.getElementById('commande').addEventListener('click',function(e){
               paymentButtn()
            })
            function paymentButtn() 
            {
               console.log('le button de sauvgareder est click')
               var userFormDat = {'total':tota,'fournisseur':option}
			   console.log(option)
               var url ='/process_commande/'
               fetch(url,{
                  method:'POST',
                  headers:{
                          'Content-Type': 'application/json',
                          'X-CSRFToken': csrftoken,},
                  body:JSON.stringify({'form':userFormDat }) })
                  .then((response) => response.json())
                  .then((data)=>{
                          console.log('Success:',data);
                          alert('la commande est enregistrer');
                          window.location.href="{% url 'commande'%}"}) 
             }
</script>
{% endblock %}
